\documentclass{article}
\input{preamble.tex}
% Recommended, but optional, packages for figures and better typesetting:
\usepackage{microtype}
\usepackage{graphicx}
\usepackage{booktabs} % for professional tables

% hyperref makes hyperlinks in the resulting PDF.
\usepackage{hyperref}

% Attempt to make hyperref and algorithmic work together better:
\newcommand{\theHalgorithm}{\arabic{algorithm}}

% Use the following line for the initial blind version submitted for review:
\usepackage{icml2023}

% For theorems and such
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{amsthm}

% THEOREMS
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}

% The \icmltitle you define below is probably too long as a header.
% Therefore, a short form for the running title is supplied here:
\icmltitlerunning{The Ensemble Kalman Update as an Empirical Matheron Update}

\begin{document}

\twocolumn[
\icmltitle{The Ensemble Kalman Update is an Empirical Matheron Update}

% It is OKAY to include author information, even for blind submissions:
\begin{icmlauthorlist}
\icmlauthor{Firstname1 Lastname1}{affiliation}
\icmlauthor{Firstname2 Lastname2}{affiliation}
\end{icmlauthorlist}

\icmlaffiliation{affiliation}{Department, University, City, Country}

\icmlcorrespondingauthor{Firstname1 Lastname1}{email@domain.com}

% You may provide any keywords that you find helpful for describing your paper
\icmlkeywords{Ensemble Kalman Filter, Matheron Update, Data Assimilation, Gaussian Processes}

\vskip 0.3in
]

\printAffiliationsAndNotice{}  % leave blank if no need to mention equal contribution

\begin{abstract}
The Ensemble Kalman Filter (EnKF) is a widely used method for data assimilation in high-dimensional systems. In this paper, we show that the ensemble update step of the EnKF is equivalent to an empirical Matheron update for Gaussian random variables. This connection provides a probabilistic interpretation of the EnKF and opens avenues for improving ensemble-based data assimilation methods by leveraging properties of the Matheron update.
\end{abstract}

\section{Introduction}
The Ensemble Kalman Filter (EnKF) \citep{evensen2009data} has become a cornerstone in data assimilation for large-scale dynamical systems due to its computational efficiency and scalability. The EnKF approximates the state estimation problem by evolving an ensemble of state vectors through the model dynamics and updating them using observational data. Despite its widespread application, the theoretical underpinnings of the EnKF are not fully understood, especially regarding its probabilistic interpretation.

Separately, the Matheron update provides a sample-based method for conditioning Gaussian random variables on observations without explicitly computing covariance matrices \citep{matheron1963principles}. This approach is well-established in geostatistics and spatial statistics but has not been widely connected to ensemble methods in data assimilation.

In this paper, we establish that the ensemble update step in the EnKF is an empirical implementation of the Matheron update. By recognizing this equivalence, we provide a probabilistic foundation for the EnKF and suggest potential improvements in ensemble data assimilation techniques by leveraging the properties of the Matheron update.

\section{Background}

\subsection{Ensemble Kalman Filter}
The EnKF is an extension of the classical Kalman Filter designed for nonlinear, high-dimensional systems. It uses an ensemble of $N$ state vectors $\{\mathbf{x}^{(i)}\}_{i=1}^N$ to represent the probability distribution of the state.

At each assimilation step, the ensemble members are updated according to:
\begin{equation}
    \mathbf{x}^{(i)} = \mathbf{x}^{(i)} + \mathbf{K} \left( \mathbf{y} + \boldsymbol{\varepsilon}^{(i)} - \mathbf{H} \mathbf{x}^{(i)} \right),
    \label{eq:enkf_update}
\end{equation}
where $\mathbf{y}$ is the observation vector, $\mathbf{H}$ is the observation operator, $\boldsymbol{\varepsilon}^{(i)}$ is the observational noise for the $i$-th ensemble member, and $\mathbf{K}$ is the Kalman gain computed from the ensemble covariance matrices.

\subsection{Matheron Update}
The Matheron update is a technique for sampling from the conditional distribution of a Gaussian random variable given observations. Given a jointly Gaussian vector $\begin{bmatrix} \mathbf{x} \\ \mathbf{z} \end{bmatrix}$ with mean $\begin{bmatrix} \boldsymbol{\mu}_x \\ \boldsymbol{\mu}_z \end{bmatrix}$ and covariance $\begin{bmatrix} \mathbf{C}_{xx} & \mathbf{C}_{xz} \\ \mathbf{C}_{zx} & \mathbf{C}_{zz} \end{bmatrix}$, a sample from the conditional distribution $p(\mathbf{x} | \mathbf{z} = \mathbf{z}^*)$ can be obtained by:
\begin{equation}
    \mathbf{x} = \mathbf{x}_0 + \mathbf{C}_{xz} \mathbf{C}_{zz}^{-1} \left( \mathbf{z}^* - \mathbf{z}_0 \right),
    \label{eq:matheron_update}
\end{equation}
where $\mathbf{x}_0$ and $\mathbf{z}_0$ are samples from the prior distributions of $\mathbf{x}$ and $\mathbf{z}$, respectively.

\section{Equivalence of the EnKF Update and the Matheron Update}

\subsection{Derivation}

Consider the EnKF update in Equation~\eqref{eq:enkf_update}. The Kalman gain $\mathbf{K}$ is computed as:
\begin{equation}
    \mathbf{K} = \mathbf{C}_{xy} \mathbf{C}_{yy}^{-1},
    \label{eq:kalman_gain}
\end{equation}
where $\mathbf{C}_{xy}$ is the cross-covariance between the state and the observations, and $\mathbf{C}_{yy}$ is the covariance of the observations, both estimated from the ensemble.

Substituting Equation~\eqref{eq:kalman_gain} into Equation~\eqref{eq:enkf_update}, we have:
\begin{equation}
    \mathbf{x}^{(i)} = \mathbf{x}^{(i)} + \mathbf{C}_{xy} \mathbf{C}_{yy}^{-1} \left( \mathbf{y} + \boldsymbol{\varepsilon}^{(i)} - \mathbf{H} \mathbf{x}^{(i)} \right).
\end{equation}

Noting that $\mathbf{z}^{(i)} = \mathbf{H} \mathbf{x}^{(i)} + \boldsymbol{\varepsilon}^{(i)}$ represents the model counterpart of the observations for each ensemble member, we can rewrite the update as:
\begin{equation}
    \mathbf{x}^{(i)} = \mathbf{x}^{(i)} + \mathbf{C}_{xz} \mathbf{C}_{zz}^{-1} \left( \mathbf{y} - \mathbf{z}^{(i)} \right).
    \label{eq:enkf_matheron}
\end{equation}

This is exactly the form of the Matheron update in Equation~\eqref{eq:matheron_update}, where $\mathbf{x}^{(i)}$ and $\mathbf{z}^{(i)}$ are samples from the prior distributions of $\mathbf{x}$ and $\mathbf{z}$, respectively. Therefore, the EnKF update is an empirical Matheron update.

\subsection{Interpretation}

The equivalence implies that the EnKF performs an approximate Bayesian update by applying the Matheron update to the ensemble members. The ensemble covariances $\mathbf{C}_{xz}$ and $\mathbf{C}_{zz}$ serve as empirical estimates of the true covariances. This perspective provides a probabilistic interpretation of the EnKF and explains its effectiveness in assimilating data in high-dimensional systems.

\section{Implications for Data Assimilation}

Understanding the EnKF as an empirical Matheron update opens up several possibilities:

\begin{itemize}
    \item \textbf{Improved Covariance Estimation}: Techniques from geostatistics for better covariance estimation can be applied to enhance the EnKF performance.
    \item \textbf{Sampling Methods}: Advanced sampling strategies used in Gaussian process modeling can be integrated into the EnKF framework.
    \item \textbf{Error Characterization}: The probabilistic foundation allows for a better characterization of the errors and uncertainties associated with the EnKF estimates.
\end{itemize}

\section{Conclusion}

We have demonstrated that the ensemble update step in the EnKF is equivalent to the empirical Matheron update for Gaussian random variables. This connection provides a deeper probabilistic understanding of the EnKF and suggests avenues for enhancing ensemble-based data assimilation methods by leveraging the properties of the Matheron update.

% Acknowledgements and references can be added here

\bibliographystyle{icml2023}
\bibliography{refs}

\end{document}
